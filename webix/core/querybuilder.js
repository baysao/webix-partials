/*
@license
Webix Query Builder v.4.4.0
This software is can be used only as part of webix.com site
You are not allowed to copy this file and use in any other project
*/
!function(e){function t(n){if(i[n])return i[n].exports;var l=i[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,t),l.l=!0,l.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/codebase/",t(t.s=4)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.locale={or:"or",and:"and",delete_rule:"Delete rule",add_rule:"Add rule",add_group:"Add group",less:"less",less_or_equal:"less or equal",greater:"greater",greater_or_equal:"greater or equal",between:"between",not_between:"not between",begins_with:"begins with",not_begins_with:"not begins with",contains:"contains",not_contains:"not contains",ends_with:"ends with",not_ends_with:"not ends with",is_empty:"is empty",is_not_empty:"is not empty",equal:"equal",not_equal:"not equal",is_null:"is null",is_not_null:"is not null",default_option:"---",cancel:"Cancel",filter:"Filter"}},function(e,t){},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(1);var n=i(0);webix.ui.datafilter.queryBuilder=webix.extend({getValue:function(){return this._qb.getValue()},setValue:function(e,t){t&&this._qb.setValue(t)},refresh:function(e,t,i){t.component=e.config.id,e.registerFilter(t,i,this),t._comp_id=e.config.id,i.value&&this.getValue(i)!==i.value&&(this.setValue(t,i.value),e.filterByAll()),webix.event(t,"click",this._filterShow.bind(this,t))},compare:function(e,t,i){return this._qb.getFilterHelper()(i)},render:function(e,t){var i=this;t.css="webix_ss_filter",t.compare=this.compare.bind(this);var l={view:"querybuilder",fields:t.fields||[]},u=this._buttonCreate(n.locale.filter,function(){if(i._qb){var t=i._qb.getFilterHelper();e.filter(t,void 0,void 0),i._popup.hide()}}),s=this._buttonCreate(n.locale.cancel,function(){i._popup.hide()}),a={margin:5,rows:[l,{cols:[u,s,{}]}]},r={view:"popup",width:1e3,body:a};return this._popup=webix.ui(r),this._qb=this._popup.getBody().getChildViews()[0],e.attachEvent("onDestruct",function(){i._popup.destructor()}),'<div class="webix_qb_filter"><i class="fa fa-filter" aria-hidden="true"></i></div>'+(t.label||"")},_filterShow:function(e){this._popup.show(e.querySelector(".webix_qb_filter .fa"))},_buttonCreate:function(e,t){return{view:"button",value:e,align:"right",width:120,click:t}}},webix.EventSystem)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(1);var n=i(0);webix.i18n.querybuilder=n.locale,webix.protoUI({name:"querybuilderline",defaults:{height:36,margin:5,borderless:!0},$init:function(){this.$view.className+=" webix_querybuilder_line",this.$ready.push(this._setqueryline)},refreshFilters:function(e){this.config.filters=e,this._setRuleSelect(this.config.value,this.config.fields,!0)},_setqueryline:function(){var e=this;this.$view.innerHTML='<div class="webix_querybuilder_line-content">\n\t\t<select class="webix_querybuilder_value_select"></select>\n\t\t<select class="webix_querybuilder_rule_select" style="display: none;"></select>\n\t\t<input type="text" class="webix_querybuilder_rule_input" style="display: none;">\n\t\t<button class="webix_querybuilder_close fa fa-trash-o" title="'+n.locale.delete_rule+'"></button>\n\t\t</div>';var t=this.$view.querySelector(".webix_querybuilder_close");this.eventObj&&webix.eventRemove(this.eventObj),this.eventObj=webix.event(t,"click",function(t){e._updateValueObject(),e.getParentView().getParentView()._deleteRow(e)}),this._setKeySelect()},_setPreselectedKeys:function(e){this._setKeySelect(e),this._setRuleSelect(e,this.config.fields)},_updateValueObject:function(e){var t=this.getParentView().getParentView();t.childsIdArray||(t.childsIdArray=[]);var i=t.childsIdArray,n=t.config.value.rules;e?i.indexOf(this.config.id)>-1||"not_selected"===e.key?i.indexOf(this.config.id)>-1&&"not_selected"===e.key&&(n.splice(i.indexOf(this.config.id),1),i.splice(i.indexOf(this.config.id),1)):(i.push(this.config.id),n.push(e)):i.indexOf(this.config.id)>-1&&(n.splice(i.indexOf(this.config.id),1),i.splice(i.indexOf(this.config.id),1))},_setKeySelect:function(e){var t=this,i=this.$view.querySelector(".webix_querybuilder_value_select"),l=["<option value='not_selected'>"+n.locale.default_option+"</option>"],u=this.config.fields,s={};u.forEach(function(e,t,n){l.push("<option value='"+e.id+"'>"+e.value+"</option>"),i.innerHTML=l.join("")}),e?(i.value=e.key,this._updateRules(e)):e=s,this.eventSelEl&&webix.eventRemove(this.eventSelEl),this.eventSelEl=webix.event(i,"change",function(i){e.key=i.target.value,t._updateValueObject(e),e.rule=void 0,t._updateRules(e),t._setRuleSelect(e,u)})},_setRuleSelect:function(e,t,i){var l=this,u=this.$view.querySelector(".webix_querybuilder_rule_select");if(u.innerHTML="","not_selected"!==e.key){var s=this._setFilterRule(e.key,t),a=[];s.forEach(function(e,t,i){for(var l in n.locale)l===e.id&&a.push("<option value='"+e.id+"'>"+n.locale[l]+"</option>");u.innerHTML=a.join("")}),u.style.display="",e.rule||(e.rule=s[0].id,e.value=null),u.value=e.rule,i||this._setRuleEl(e,u.value)}else e.rule=void 0,this._updateRules(e),u.style.display="none",i||this._setRuleEl(e);this._updateRules(e),i||(this.eventSelRule&&webix.eventRemove(this.eventSelRule),this.eventSelRule=webix.event(u,"change",function(t){l.config.filters.forEach(function(i){for(var l in n.locale)l===i.id&&n.locale[l]===t.target.options[t.target.selectedIndex].text&&(e.rule=i.id)}),l._updateRules(e),l._setRuleEl(e),e.value&&l._callChangeMethod()}))},_setFilterRule:function(e,t){var i=[];for(var n in t)t[n].id===e&&(this.ruleType=t[n].type);for(var l in this.config.filters)"date"===this.ruleType&&"number"===this.config.filters[l].type&&i.push(this.config.filters[l]),this.config.filters[l].type!==this.ruleType&&"any"!==this.config.filters[l].type||i.push(this.config.filters[l]);return i},_updateRules:function(e){var t={};return this.config.value||(this.config.value=t),e&&(this.config.value={key:e.key,rule:e.rule,value:e.value}),this.config.value},_getTopQuery:function(){var e=this.getParentView().getParentView();return e._getTopQuery?e._getTopQuery():e},_callChangeMethod:function(){this._getTopQuery().callEvent("onChange",[])},_changeRule:function(e){this._updateRules(e),this._callChangeMethod()},_setRuleEl:function(e){var t,i=this,n=this.$view.querySelector(".webix_querybuilder_rule_input"),l=this.$view.querySelector(".webix_datepicker_single"),u=this.$view.querySelector(".webix_datepicker_range"),s=this.$view.querySelector(".webix_el_slider");if(n.style.display="none",this.eventObjInput&&webix.eventRemove(this.eventObjInput),this.eventObjInput=webix.event(n,"keydown",function(n){t&&clearTimeout(t),t=setTimeout(function(){e.value=n.target.value,"number"===i.ruleType&&(e.value=Number(n.target.value)),i._changeRule(e)},250)}),n.value=e.value,l&&(l.style.display="none"),u&&(u.style.display="none"),s&&(s.style.display="none"),"is_null"===e.rule||"is_not_null"===e.rule)return e.value=null,void this._changeRule(e);if("is_not_empty"===e.rule||"is_empty"===e.rule)return e.value="",void this._changeRule(e);if(e&&e.rule){if(!e.key)return;if("date"===this.ruleType&&"is_null"!==e.rule&&"is_not_null"!==e.rule){if(this.config.value.value&&"object"==typeof this.config.value.value&&this.config.value.value.length?this.config.value.value="":this.config.value.value||(this.config.value.value=new Date),"between"===e.rule||"not_between"===e.rule)if(u)u&&(e.value&&e.value.start?this.config.value.value=this.config.value.value:e.value&&""===e.value.start||!e.value?this.config.value.value={start:new Date,end:new Date}:e.value&&(this.config.value.value={start:e.value,end:e.value}),this._datepickerRange.setValue(this.config.value.value),u.style.display="inline-block");else{(this.config.value.value&&!this.config.value.value.start||this.config.value.value&&!this.config.value.value.end)&&(this.config.value.value={start:this.config.value.value,end:this.config.value.value});var a=webix.ui({container:this.$view.childNodes[0],view:"daterangepicker",css:"webix_datepicker_range",width:240,value:this.config.value.value});this.attachEvent("onDestruct",function(){return a.destructor()}),this._datepickerRange=a,a.$view.style.display="inline-block"}else if("between"!==e.rule&&"not_between"!==e.rule)if(this.config.value.value&&this.config.value.value.end?this.config.value.value=this.config.value.value.start:this.config.value.value||(this.config.value.value=new Date),l)l&&(e.value&&e.value.start?this.config.value.value=e.value.start:e.value&&""===e.value.start||!e.value?this.config.value.value=new Date:e.value&&(this.config.value.value=e.value),this._datepicker.setValue(this.config.value.value),l.style.display="inline-block");else{var r=webix.ui({container:this.$view.childNodes[0],view:"datepicker",width:240,height:38,css:"webix_datepicker_single",value:this.config.value.value});this.attachEvent("onDestruct",function(){return r.destructor()}),this._datepicker=r,r.$view.style.display="inline-block"}e.value=this.config.value.value,this._changeRule(e)}else if("between"!==e.rule&&"not_between"!==e.rule||"date"===this.ruleType)n.style.display="";else if(s)s&&"none"===s.style.display&&(e.value&&!e.value.length?e.value=[0,this.config.value.value]:e.value||this._slider.setValue([0,0]),this._slider.setValue(e.value),s.style.display="inline-block");else{this.config.value.value?this.config.value.value.length||(this.config.value.value=[0,this.config.value.value]):this.config.value.value=[0,0];var o=webix.ui({container:this.$view.childNodes[0],view:"rangeslider",title:function(e){var t=e.value;return t[0]===t[1]?t[0]:t[0]+" - "+t[1]},width:240,height:36,value:this.config.value.value});this.attachEvent("onDestruct",function(){return o.destructor()}),this._slider=o,o.$view.style.display="inline-block"}}this._handleEvents(e)},_handleEvents:function(e){var t=this;this._slider&&(this.eventObjSlider&&this._slider.detachEvent(this.eventObjSlider),this.eventObjSlider=this._slider.attachEvent("onChange",function(i){e.value=i,t._changeRule(e)})),this._datepicker&&(this.eventObjData&&this._datepicker.detachEvent(this.eventObjData),this.eventObjData=this._datepicker.attachEvent("onChange",function(i){e.value=i,t._changeRule(e)})),this._datepickerRange&&(this.eventObjDataRange&&this._datepickerRange.detachEvent(this.eventObjDataRange),this.eventObjDataRange=this._datepickerRange.attachEvent("onChange",function(i){e.value=i,t._changeRule(e)}))},getValue:function(){return this.config.value},setValue:function(e){this.config.value=e,this._setPreselectedKeys(this.config.value)},getFilterHelper:function(){var e,t=this,i=this.config.value,n=this.config.filters,l=function(l){for(var u in n){var s="fn";if(n[u].id===i.rule)if(null===i.value)e=n[u][s](l[i.key],i.value);else if("date"===t.ruleType){var a=l[i.key].getTime(),r=i.value.getTime();e=n[u][s](a,r)}else e="string"==typeof i.value&&"string"==typeof l[i.key]?n[u][s](l[i.key].toLowerCase(),i.value.toLowerCase()):"number"===t.ruleType&&"number"==typeof l[i.key]?n[u][s](l[i.key],Number(i.value)):n[u][s](l[i.key],i.value[0],i.value[1])}return e};return l}},webix.ui.view,webix.EventSystem)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(1);var n=i(0);i(2),i(3),webix.i18n.querybuilder=n.locale,webix.protoUI({name:"querybuilder",defaults:{padding:10,type:"space",fields:[],borderless:!0},$init:function(){this.$view.className+=" webix_querybuilder_wrap";var e={glue:"and",rules:[]};this.config.value=e,this.$ready.unshift(this._setLayout)},_filters:[{id:"less",name:n.locale.less,fn:function(e,t){return e<t},type:"number"},{id:"less_or_equal",name:n.locale.less_or_equal,fn:function(e,t){return e<=t},type:"number"},{id:"greater",name:n.locale.greater,fn:function(e,t){return e>t},type:"number"},{id:"greater_or_equal",name:n.locale.greater_or_equal,fn:function(e,t){return e>=t},type:"number"},{id:"between",name:n.locale.between,fn:function(e,t,i){return e>t&&e<i},type:"number"},{id:"not_between",name:n.locale.not_between,fn:function(e,t,i){return e<=t||e>=i},type:"number"},{id:"begins_with",name:n.locale.begins_with,fn:function(e,t){return 0===e.lastIndexOf(t,0)},type:"string"},{id:"not_begins_with",name:n.locale.not_begins_with,fn:function(e,t){return 0!==e.lastIndexOf(t,0)},type:"string"},{id:"contains",name:n.locale.contains,fn:function(e,t){return e.indexOf(t)!==-1},type:"string"},{id:"not_contains",name:n.locale.not_contains,fn:function(e,t){return t.indexOf(e)===-1},type:"string"},{id:"ends_with",name:n.locale.ends_with,fn:function(e,t){return e.indexOf(t,e.length-t.length)!==-1},type:"string"},{id:"not_ends_with",name:n.locale.not_ends_with,fn:function(e,t){return e.indexOf(t,e.length-t.length)===-1},type:"string"},{id:"is_empty",name:n.locale.is_empty,fn:function(e){return 0===e.length},type:"string"},{id:"is_not_empty",name:n.locale.is_not_empty,fn:function(e){return e.length>0},type:"string"},{id:"equal",name:n.locale.equal,fn:function(e,t){return e===t},type:"any"},{id:"not_equal",name:n.locale.not_equal,fn:function(e,t){return e!==t},type:"any"},{id:"is_null",name:n.locale.is_null,fn:function(e){return null===e},type:"any"},{id:"is_not_null",name:n.locale.is_not_null,fn:function(e){return null!==e},type:"any"}],_deleteGroup:function(e){var t=this.getChildViews()[1];t.removeView(e),this._callChangeMethod()},_deleteRow:function(e){var t=this.getChildViews()[1];if(t.removeView(e),this._callChangeMethod(),t.getChildViews().length<=1){var i=this.getParentView().getParentView();this._deleteValue(this),i&&i._getTopQuery&&webix.delay(function(){i._deleteGroup(this.config.id)},this)}},_getTopQuery:function(){var e=this.getParentView();return this.getParentView().getParentView()&&this.getParentView().getParentView()._getTopQuery?(e=e.getParentView(),e._getTopQuery?e._getTopQuery():e):this},_callChangeMethod:function(){if(!this.config.value.rules.length){var e={glue:"and",rules:[]};this.config.value=e}this._getTopQuery().callEvent("onChange",[])},_updateValue:function(e,t){var i={glue:"and",rules:[]},n=i,l=webix.$$(this.config.id);l.childsIdArray||(l.childsIdArray=[]),l.childsIdArray.indexOf(t.config.id)===-1&&l.childsIdArray.push(t.config.id),t.config.value=n,this.config.value.rules.push(n)},_deleteValue:function(e){var t=e.getParentView().getParentView();if(t){var i=t.childsIdArray;i&&i.indexOf(e.config.id)>-1&&(t.childsIdArray.splice(i.indexOf(e.config.id),1),t.config.value.rules.splice(i.indexOf(e.config.id),1))}},_setLayout:function(){var e=this,t=[{template:'<div class="webix_querybuilder_ifbuttons">\n\t\t\t\t<button class="webix_querybuilder_and webix_active">'+n.locale.and+'</button>\n\t\t\t\t<button class="webix_querybuilder_or">'+n.locale.or+"</button>\n\t\t\t</div>",onClick:{webix_querybuilder_or:function(t){e.config.value.glue="or",e._setActiveButtons(e.$view)},webix_querybuilder_and:function(t){e.config.value.glue="and",e._setActiveButtons(e.$view,"and")}},height:34,width:87},{rows:[{template:'<div class="webix_querybuilder_buttons">\n\t\t\t\t\t<button class="webixbutton webix_querybuilder_group">+ '+n.locale.add_group+'</button>\n\t\t\t\t\t<button class="webixbutton webix_querybuilder_rule">+ '+n.locale.add_rule+"</button>\n\t\t\t\t</div>",onClick:{webix_querybuilder_rule:function(t){var i=e.getChildViews()[1];i.addView({view:"querybuilderline",id:webix.uid().toString(),fields:e.config.fields,filters:e._filters},i.getChildViews().length-1)},webix_querybuilder_group:function(t){var i=e.getChildViews()[1],n=webix.uid().toString(),l=(i.addView({view:"querybuilder",id:n,fields:e.config.fields},i.getChildViews().length-1),webix.$$(n)),u=l.getChildViews()[1];u.addView({view:"querybuilderline",fields:e.config.fields,filters:e._filters},u.getChildViews().length-1),e._updateValue(e,l)}},height:14}],margin:5}];this.cols_setter(t)},_checkItemRules:function(e,t){var i=t.getChildViews()[1];t.childsIdArray||(t.childsIdArray=[]),e.glue&&"and"===e.glue?this._setActiveButtons(t.$view,"and"):e.glue&&"or"===e.glue&&this._setActiveButtons(t.$view),e.rules&&e.rules.forEach(function(e){var n=webix.uid().toString();if(e.glue)i.addView({view:"querybuilder",id:n,value:e,fields:this.config.fields},i.getChildViews().length-1),t.childsIdArray.push(n),e.rules&&this._checkItemRules(e,$$(n));else{t.childsIdArray.push(n);i.addView({view:"querybuilderline",id:n,fields:this.config.fields,filters:this._filters},i.getChildViews().length-1);webix.$$(n).setValue(e)}}.bind(this))},_setActiveButtons:function(e,t,i){var n=e.querySelector(".webix_querybuilder_and"),l=e.querySelector(".webix_querybuilder_or");n&&(n.classList.remove("webix_active"),t?(l.classList.remove("webix_active"),n.className+=" webix_active"):(n.classList.remove("webix_active"),l.className+=" webix_active")),this._callChangeMethod()},setFilters:function(e){this._filters=e,this.childsIdArray.forEach(function(t){$$(t).reconstruct?$$(t).setFilters(e):$$(t).refreshFilters(e)})},getFilters:function(){return this._filters},getValue:function(){return[this.config.value,this.config.fields]},setValue:function(e){var t=e[0];this.childsIdArray=[],this.reconstruct(),e[1]?(this.config.value=t,this.config.fields=e[1]):t[0]?this.config.fields=t:this.config.value=t,this._checkItemRules(this.config.value,this)},focus:function(){var e=this.$view.querySelector(".webix_active");e.focus()},getFilterHelper:function(){var e,t=webix.$$(this).childsIdArray,i=this.config.value.glue,n=[];for(var l in t)n.push(webix.$$(t[l]).getFilterHelper());var u=function(t){return"and"===i?(e=!0,n.forEach(function(i){i(t)||(e=!1)})):(e=!1,n.forEach(function(i){i(t)&&(e=!0)})),e};return u}},webix.ui.layout,webix.EventSystem)}]);
//# sourceMappingURL=querybuilder.js.map
